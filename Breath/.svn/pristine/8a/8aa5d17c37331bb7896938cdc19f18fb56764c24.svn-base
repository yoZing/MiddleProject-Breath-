<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
<script src="../../js/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="../../css/main.css" />

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js" integrity="sha512-WFN04846sdKMIP5LKNphMaWzU7YpMyCU245etK3g/2ARYbPK9Ub18eG+ljU96qKRCWh+quCY7yefSmlkQw1ANQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.8.0/gsap.min.js" integrity="sha512-eP6ippJojIKXKO8EPLtsUMS+/sAGHGo1UN/38swqZa1ypfcD4I0V/ac5G3VzaHfDaklFmQLEs51lhkkVaqg60Q==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> 
<script defer src="../../js/main.js"></script>


<title>관리자 페이지</title>
<style>
.chartArea{
	display: inline-block;
 	float:left;
}
.chart1 {
	width: 1000px;
	height: 500px;
}
.valArea{
	display: inline-block;
 	float:left;
}

#yearChart {
	display:inline-block;
	float:left;
}
#monthChart {
	display:inline-block;
	float:right;
}

.listContainer{
 	display: inline-block;
 	float:left;
}

#admenu {
	display: inline-block;
}
.wrap{
	padding-top: 100px;
}
.adth {
	width: 150px;
	height: 70px;
	background-color: skyblue;
	text-align: center;
}
td {
	width: 150px;
	height: 70px;
	text-align: center;
}
#th1 {
	width: 70px;
}
caption {
	font-size: 2.0em;
	text-align: center;
}
#aArea{
	padding-left: 100px;
}
#bArea{
	padding-left: 100px;
}
</style>
</head>
<body>

   <!-- HEADER -->
  <!-- HEADER -->
  <header>
    <div class="inner">

      <a href="/Breath/index.jsp" onClick="" class="logo">
        BES
      </a>

      <div class="sub-menu">
        <ul class="menu">
          <li id="li1">
            <a href="/Breath/views/admin/admin.html"><div>Admin Page</div></a>
          </li>
          <li>
            <a href="/Breath/views/mypage/mypage.jsp">My Page</a>
          </li>
          <li>
            <a href="javascript:void(0)">Customer Service</a>
          </li>
        </ul>
        <div class="search">
          <input type="text" />
          <div class="material-icons">search</div>
        </div>
           &nbsp;&nbsp;&nbsp;<div id="log-out" class="btn sign-in">로그아웃</div>
      </div>

      <ul class="main-menu">
        <li class="item">
          <div class="item__name" onclick="location.href='/Breath/trainer/trainerList.do'">TRAINER</div>
          <div class="item__contents">
            <div class="contents__menu">
              <ul class="inner">
                <li>
                  <h4>구독자</h4>
                </li>
                <li>
                  <h4>멤버쉽</h4>
                </li>
                <li>
                  <h4>운동종류</h4>
                </li>
                <li>
                  <h4>트레이너명</h4>
                </li>
              </ul>
            </div>
            
          </div>
        </li>
        <li class="item">
          <div class="item__name" onclick="location.reload();">REVIEW</div>
          <div class="item__contents">
            <div class="contents__menu">
              <ul class="inner">
                <li>
                  <h4>리뷰 조회</h4>
                </li>
                <li>
                  <h4>리뷰 작성</h4>
                </li>
              </ul>
            </div>
        
          </div>
        </li>
        <li class="item">
          <div class="item__name" onclick="location.href='/Breath/List.qnaBoard'">Q&A</div>
          <div class="item__contents">
            <div class="contents__menu">
              <ul class="inner">
                <li>
                  <h4>문의글 조회</h4>
                </li>
                <li>
                  <h4>문의글 작성</h4>
                </li>
              </ul>
            </div>
            
          </div>
        </li>
        <li class="item">
          <div class="item__name" onclick="location.href='/Breath/NoticeList.do'">NOTICE</div>
          <div class="item__contents">
            <div class="contents__menu">
              <ul class="inner">
                <li>
                  <h4>공지사항</h4>
                </li>
                <li>
                  <h4>자주 묻는 질문</h4>
                </li>
              </ul>
            </div>
            
          </div>
        </li>
        
      </ul>
    </div>

<!--     <div class="badges"> -->
<!--       <div class="badge"> -->
<!--         배너 -->
<!--         <img src="./images/badge1.jpg" alt="Badge" /> -->
<!--       </div> -->
<!--       <div class="badge">
<!--         <img src="./images/badge2.jpg" alt="Badge" /> -->
<!--       </div> -->
<!--     </div> -->

  </header>
  <!-- Header End -->
<div class="wrap">
  <div class="greenContainer">
    <div>
<!--       <div class="grade">트레이너</div> -->
      <div class="name">관리자 페이지</div>
    </div>    
  </div>
  
  <div class="listContainer">
  	<span id="dash" style="cursor:pointer;">
	    <a class="item">
	        <div class="icon">ii</div>
	        	<div class="text">DashBoard</div>
	        <div class="right"> > </div>
	    </a>
    </span>
    <span id="sales" style="cursor:pointer;">
	    <a class="item">
	        <div class="icon">ii</div>
	       		<div class="text">매출조회</div>
	        <div class="right"> > </div>
	    </a>
    </span>
    <span id="memcon" style="cursor:pointer;">
	    <a class="item">
	        <div class="icon">ii</div>
	        	<div class="text">회원조회</div>
	        <div class="right"> > </div>
	    </a>
    </span>
    <span id="report" style="cursor:pointer;">
	    <a class="item">
	        <div class="icon">ii</div>
	        	<div class="text"><span id="report">신고관리</span></div>
	        <div class="right"> > </div>
	    </a>
	</span>
    <span id="black" style="cursor:pointer;">
	    <a class="item">
	        <div class="icon">ii</div>
	        	<div class="text"><span id="black">블랙리스트</span></div>
	        <div class="right"> > </div>
	    </a>
	</span>
  </div>
  
	<div class="valArea">
		<div id="aArea"></div>
		<br>
		<div id="bArea"></div>
	</div>
			
	<div class="chartArea">		
		<div class="chart1">
			<canvas id="yearChart"></canvas>
		</div>
		<br>
		<div class="chart1">
			<canvas id="monthChart"></canvas>
		</div>
	</div>
	
</div>

	<script type="text/javascript">
	
///////////////////////////////////////////    DASH BOARD     /////////////////////////////////////////////

	$('#dash').on('click', function(){
		$("#aArea").empty();
		$("#bArea").empty();
		
		$.ajax({
			url : '/Breath/dashBoard.do',
			type : 'get',
			success : function(db) {
				$('#aArea').html(db);
			},
			error : function(xhr) {
				alert(xhr.status);
			},
			dataType : 'html'
		});
	});

///////////////////////////////////////////    매출 조회     /////////////////////////////////////////////
	
		
	$('#sales').on('click', function(){
		$("#aArea").empty();
		$("#bArea").empty();
		/* 2021년 월 단위 매출 */
		const labels = [ 'January', 'February', 'March', 'April', 'May',
						 'June', 'July', 'August', 'September', 'October', 'November', 'December' ];
		const data = {
			labels : labels,
			datasets : [{
				label : '2021년도 매출',
				backgroundColor : 'rgb(255, 99, 132)',
				borderColor : 'rgb(255, 99, 132)',
				data : [ 25, 20, 17, 42, 37, 30, 45, 70, 90, 100, 60, 75, 150 ],
			}]
		};
		const config = {
			type : 'bar',
			data : data,
			options : {}
		};
		const yearChart = new Chart(document.getElementById('yearChart'), config);
		
		
		/* 2022년 1월 일 단위 매출 */
		const labels2 = [ '1일', '2일', '3일', '4일', '5일', '6일', '7일', '8일', '9일', '10일',
			 '11일', '12일', '13일', '14일', '15일', '16일', '17일', '18일', '19일' ];
		const data2 = {
			labels : labels2,
			datasets : [{
				label : '2022년 1월 매출',
				backgroundColor : 'rgb(255, 99, 132)',
				borderColor : 'rgb(255, 99, 132)',
				data : [ 55, 63, 72, 90, 123, 115, 102, 150, 142, 128,
					90, 102, 157, 270, 240, 206, 167, 200 ],
			}]
		};

		const config2 = {
			type : 'line',
			data : data2,
			options : {}
			};

			const monthChart = new Chart(document.getElementById('monthChart'), config2);
		
	});
	
	
///////////////////////////////////////////    회원 관리     /////////////////////////////////////////////

		// 전체 회원 목록을 불러옴.
		$('#memcon').on('click', function() {
			$("#aArea").remove;
			$("#bArea").empty();
			
			$.ajax({
				url : '/Breath/memList.do',
				type : 'get',
				success : function(ml) {
					let code = `<div class="container">`;
					code += `<table class="table">`;
					code += `	<caption>회원 목록</caption>`;
					code += `<tr>`;
					code += `	<th class="adth">회원 ID</th>`;
					code += `	<th class="adth">권한코드</th>`;
					code += `	<th class="adth">상태코드</th>`;
					code += `	<th class="adth">이름</th>`;
					code += `	<th class="adth">닉네임</th>`;
					code += `</tr>`;
					$.each(ml, function() {
						code += `<tr class="mline">`;
						code += `	<td>${this.memId}</td>`;
						code += `	<td>${this.athrtCode}</td>`;
						code += `	<td>${this.status}</td>`;
						code += `	<td>${this.memNm}</td>`;
						code += `	<td>${this.nickName}</td>`;
						code += `</tr>`;
					});
					code += `</table>`;
					code += `</div>`;
					$('#aArea').html(code);
				},
				error : function(xhr) {
					alert(xhr.status);
				},
				dataType : 'json'
			});
		});

		$(document).on('mouseover', '.mline', function() {
			$(this).css({
				"background-color" : "lightblue"
			});
		});
		$(document).on('mouseout', '.mline', function() {
			$(this).css({
				"background-color" : "white"
			});
		});
		
		// 전체회원 목록에서 클릭한 회원의 상세정보를 불러온다
		$(document).on('click', '.mline', function() {
			let memId = $(this).children().eq(0).text();
			$.ajax({
				url : '/Breath/memDetail.do',
				type : 'get',
				data : { 'memId' : memId },
				success : function(md) {
					$('#aArea').html(md);
				},
				error : function(xhr) {
					alert(xhr.status);
				},
				dataType : 'html'
			});
		});

		$(document).on('mouseover', '.mline', function() {
			$(this).css({
				"background-color" : "lightblue"
			});
		});
		$(document).on('mouseout', '.mline', function() {
			$(this).css({
				"background-color" : "white"
			});
		});

///////////////////////////////////////////    신고 관리     /////////////////////////////////////////////

		// 신고관리 버튼 클릭 시 신고내역 리스트를 불러옴.
		$('#report').on('click', function() {
			$("#aArea").empty();
			$("#bArea").empty();
			
			$.ajax({
				url : '/Breath/reportList.do',
				type : 'get',
				success : function(res) {
					let code = `<div class="container">`;
					code += `<table class="table">`;
					code += `	<caption>신고 목록</caption>`;
					code += `<tr>`;
					code += `	<th class="adth">신고번호</th>`;
					code += `	<th class="adth">신고일자</th>`;
					code += `	<th class="adth">신고사유</th>`;
					code += `	<th class="adth">신고자ID</th>`;
					code += `	<th class="adth">피신고자ID</th>`;
					code += `</tr>`;
					$.each(res, function() {
						code += `<tr class="reline">`;
						code += `	<td>${this.rprtNum}</td>`;
						code += `	<td>${this.rprtDt}</td>`;
						code += `	<td>${this.rprtRsn}</td>`;
						code += `	<td>${this.rprtId}</td>`;
						code += `	<td id="retd">${this.rprtDId}</td>`;
						code += `</tr>`;
					});
					code += `</table>`;
					code += `</div>`;
					$('#aArea').html(code);
				},
				error : function(xhr) {
					alert(xhr.status);
				},
				dataType : 'json'
			});
		});

		$(document).on('mouseover', '.reline', function() {
			$(this).css({
				"background-color" : "lightblue"
			});
		});
		$(document).on('mouseout', '.reline', function() {
			$(this).css({
				"background-color" : "white"
			});
		});
		
		
		// 신고 내역 리스트에서 원하는 신고글을 클릭하면 
		// 신고대상자의 정보 디테일을 불러와서 보여줌
		$(document).on('click','.reline',function(){
			let memId = $(this).children().eq(4).text();
			console.log(memId);
			$.ajax({
				url		: '/Breath/reportDetail.do',
				type 	: 'get',
				data	: { 'memId' : memId },
				success : function(r) {
					let code = `<div class="container">`;
						code += `<table class="table">`;
					    code += `	<caption>신고대상자 정보</caption>`;
						code += `<tr>`;
						code += `	<th class="adth">회원 ID</th>`;
						code += `	<th class="adth">권한코드</th>`;
						code += `	<th class="adth">상태코드</th>`;
						code += `	<th class="adth">이름</th>`;
						code += `	<th class="adth">닉네임</th>`;
						code += `</tr>`;
					$.each(r, function() {
						code += `<tr class="dline">`;
						code += `	<td>${this.memId}</td>`;
						code += `	<td>${this.athrtCode}</td>`;
						code += `	<td>${this.status}</td>`;
						code += `	<td>${this.memNm}</td>`;
						code += `	<td>${this.nickName}</td>`;
						code += `</tr>`;
					});
					code += `</table>`;
					code += `</div>`;
					code += `<input type="button" name="list" value="목록" id="list">`;
					$('#bArea').html(code);
				},
				error	: function(xhr) {
					alert(xhr.status);
				},
				dataType : 'json'
			});
		});

		$(document).on('mouseover', '.dline', function(){
			$(this).css({"background-color" : "lightblue"});
		});
		$(document).on('mouseout', '.dline', function(){
			$(this).css({"background-color" : "white"});
		});

		// 신고대상자의 디테일 정보 리스트를 클릭하면 해당 회원을
		// 블랙리스트 회원으로 상태코드를 변경함.
		$(document).on('click','.dline',function(){
			let memId = $(this).children().eq(0).text();

			$.ajax({
				url		: '/Breath/memToBlack.do',
				type	: 'get',
				data	: { 'memId' : memId },
				success	: function(b){
					console.log(b.cd);
					if (b.cd == "no") {
						alert("수정 실패");
					} else {
						alert("수정 완료");
					}			
				},
				error	: function(xhr) {
					alert(xhr.status);
				},
				dataType : 'json'
			});
		});

///////////////////////////////////////////    블랙리스트 관리     /////////////////////////////////////////////

		// 현재 블랙리스트 목록을 모두 불러옴
		$('#black').on('click', function() {
			$("#aArea").empty();
			$("#bArea").empty();
			
			$.ajax({
				url : '/Breath/blackList.do',
				type : 'get',
				success : function(res) {
					let code = `<div class="container">`;
					code += `<table class="table">`;
					code += `	<caption>블랙회원 목록</caption>`;
					code += `<tr>`;
					code += `	<th class="adth">회원 ID</th>`;
					code += `	<th class="adth">권한코드</th>`;
					code += `	<th class="adth">상태코드</th>`;
					code += `	<th class="adth">이름</th>`;
					code += `	<th class="adth">닉네임</th>`;
					code += `</tr>`;
					$.each(res, function() {
						code += `<tr class="bline">`;
						code += `	<td>${this.memId}</td>`;
						code += `	<td>${this.athrtCode}</td>`;
						code += `	<td>${this.status}</td>`;
						code += `	<td>${this.memNm}</td>`;
						code += `	<td>${this.nickName}</td>`;
						code += `</tr>`;
					});
					code += `</table>`;
					code += `</div>`;
					$('#aArea').html(code);
				},
				error : function(xhr) {
					alert(xhr.status);
				},
				dataType : 'json'
			});
		});

		$(document).on('mouseover', '.bline', function() {
			$(this).css({
				"background-color" : "lightblue"
			});
		});
		$(document).on('mouseout', '.bline', function() {
			$(this).css({
				"background-color" : "white"
			});
		});

		// 블랙회원을 클릭하면 일반회원으로 상태코드를 변경함.
		$(document).on('click', '.bline', function() {
			let memId = $(this).children().eq(0).text();

// 			$('#bArea').html("");
			// 				$('#bArea').empty(); //입력요소의 컨텐츠에는 적용 안됨.
			// 				$('#bArea').val("");

			$.ajax({
				url : '/Breath/blackToMem.do',
				type : 'get',
				data : {
					'memId' : memId
				},
				success : function(bl) {
					console.log(bl.cd);
					if (bl.cd == "no") {
						alert("수정 실패");
					} else {
						alert("수정 완료");
					}
				},
				error : function(xhr) {
					alert(xhr.status);
				},
				dataType : 'json'
			});
		});
	</script>


</body>
</html>